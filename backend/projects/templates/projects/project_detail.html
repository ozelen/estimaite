{% extends "users/base.html" %}

{% block title %}{{ project.name }} - {{ block.super }}{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <div>
            <h1>{{ project.name }}</h1>
            {% if not project.is_active %}
            <span class="badge badge-warning">Inactive</span>
            {% endif %}
        </div>
        <div class="actions">
            <a href="{% url 'projects:project_update' project.pk %}" class="btn btn-outline">Edit Project</a>
            <a href="{% url 'projects:feature_create_for_project' project.pk %}" class="btn btn-primary">Add Feature</a>
        </div>
    </div>

    {% if project.description %}
    <div class="description-section">
        <h2>Description</h2>
        <p>{{ project.description|linebreaks }}</p>
    </div>
    {% endif %}

    <div class="features-section">
        <h2>Features</h2>

        {% if features_by_type.epic %}
        <div class="feature-group">
            <h3>Epics</h3>
            <div class="feature-list">
                {% for feature in features_by_type.epic %}
                <div class="feature-card">
                    <div class="feature-header">
                        <a href="{% url 'projects:feature_detail' feature.pk %}"><strong>{{ feature.title }}</strong></a>
                        <span class="badge badge-{{ feature.status }}">{{ feature.status }}</span>
                    </div>
                    {% if feature.description %}
                    <p class="text-muted">{{ feature.description|truncatewords:20 }}</p>
                    {% endif %}
                    <div class="feature-meta">
                        <span>Priority: {{ feature.priority }}</span>
                        {% if feature.parent %}
                        <span>Parent: <a href="{% url 'projects:feature_detail' feature.parent.pk %}">{{ feature.parent.title }}</a></span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if features_by_type.story %}
        <div class="feature-group">
            <h3>Stories</h3>
            <div class="feature-list">
                {% for feature in features_by_type.story %}
                <div class="feature-card">
                    <div class="feature-header">
                        <a href="{% url 'projects:feature_detail' feature.pk %}"><strong>{{ feature.title }}</strong></a>
                        <span class="badge badge-{{ feature.status }}">{{ feature.status }}</span>
                    </div>
                    {% if feature.description %}
                    <p class="text-muted">{{ feature.description|truncatewords:20 }}</p>
                    {% endif %}
                    <div class="feature-meta">
                        <span>Priority: {{ feature.priority }}</span>
                        {% if feature.parent %}
                        <span>Parent: <a href="{% url 'projects:feature_detail' feature.parent.pk %}">{{ feature.parent.title }}</a></span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if features_by_type.task %}
        <div class="feature-group">
            <h3>Tasks</h3>
            <div class="feature-list">
                {% for feature in features_by_type.task %}
                <div class="feature-card">
                    <div class="feature-header">
                        <a href="{% url 'projects:feature_detail' feature.pk %}"><strong>{{ feature.title }}</strong></a>
                        <span class="badge badge-{{ feature.status }}">{{ feature.status }}</span>
                    </div>
                    {% if feature.description %}
                    <p class="text-muted">{{ feature.description|truncatewords:20 }}</p>
                    {% endif %}
                    <div class="feature-meta">
                        <span>Priority: {{ feature.priority }}</span>
                        {% if feature.parent %}
                        <span>Parent: <a href="{% url 'projects:feature_detail' feature.parent.pk %}">{{ feature.parent.title }}</a></span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if not features %}
        <div class="empty-state">
            <p>No features yet. <a href="{% url 'projects:feature_create_for_project' project.pk %}">Create your first feature</a>!</p>
        </div>
        {% endif %}
    </div>
</div>

<style>
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 30px;
}

.page-header h1 {
    margin: 0 0 10px 0;
    font-size: 32px;
    font-weight: 700;
}

.actions {
    display: flex;
    gap: 10px;
}

.description-section {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    margin-bottom: 30px;
}

.features-section {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.feature-group {
    margin-bottom: 30px;
}

.feature-group:last-child {
    margin-bottom: 0;
}

.feature-group h3 {
    margin-bottom: 15px;
    color: #667eea;
    font-size: 20px;
}

.feature-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.feature-card {
    padding: 15px;
    border: 1px solid #e0e0e0;
    border-radius: 6px;
    background: #f9f9f9;
}

.feature-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.feature-header a {
    color: #333;
    text-decoration: none;
    font-size: 16px;
}

.feature-header a:hover {
    color: #667eea;
}

.feature-meta {
    display: flex;
    gap: 20px;
    margin-top: 10px;
    font-size: 14px;
    color: #666;
}

.feature-meta a {
    color: #667eea;
    text-decoration: none;
}

.badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
    text-transform: capitalize;
}

.badge-warning {
    background: #fff3cd;
    color: #856404;
}

.badge-open {
    background: #d1ecf1;
    color: #0c5460;
}

.badge-in-progress {
    background: #cce5ff;
    color: #004085;
}

.badge-done {
    background: #d4edda;
    color: #155724;
}

.empty-state {
    text-align: center;
    padding: 40px;
    color: #999;
}
</style>
{% endblock %}

